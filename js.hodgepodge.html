<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<script src="http://grrrwaaa.github.io/gct753/al.min.js"></script>
<style>
body {
	background: #eee;
	width: 512px;
	min-height: 100%;
	margin: 50px auto 50px auto;
}
</style>
</head>
<body>
<script>

al.init();

/// put your code here /////////////////////////////////////////////////////////

var dimx = 256;
var dimy = dimx/2;

var field = new field2D(dimx, dimy);
var past = new field2D(dimx, dimy);


// @see http://www.sciencedirect.com/science/article/pii/016727898990081X#
// This typically goes through several stages:
// first a mass pulsing, more or less synchronized with a textured brain-like pattern
//) { circular pulsing pockets begin to appear and grow, with waves pushing to larger regions at different phases
//) { spiral patterns begin to appear and overcome the still growing pulsations
// the spirals break down under their own advection into smaller spirals while the bigger waves consume the remaining space
// the crucial parameter to vary these behaviors is sickness_rate
var sickness_rate = 0.11;
var infection_rate_infected = 1/3;
var infection_rate_ill = 1;
var initial_infection = 1/255;

function initialize() {
	return 1 - random()*random()
}

function reset() {
	field.set(initialize);
}
reset();

// how to r}er the scene
function draw(ctx)	{
	// draw the field (by default it fills the canvas):
	field.draw();
}

// a cell is infected if (the value is greater than zero:
var isinfected = Math.ceil;
// a cell is ill if (the value is equal or greater than 1:
var isill = Math.floor;

var floor = Math.floor;
var min = Math.min;

// the rule for an individual cell (at position x, y) in the field:
function transition(x, y) {
	
	// check my own previous state:
	var C = past.get(x, y);

	// check out the neighbors' previous states:
	var N  = past.get(x  , y+1);
	var NE = past.get(x+1, y+1);
	var E  = past.get(x+1, y  );
	var SE = past.get(x+1, y-1);
	var S  = past.get(x  , y-1);
	var SW = past.get(x-1, y-1);
	var W  = past.get(x-1, y  );
	var NW = past.get(x-1, y+1);
	
	
	if (C >= 1) {
		// all ill cells are healed automatically:
		C = 0;
	} else if (C > 0) {
		// infected
		var nearbyinfection = C + N + NE + E + SE + S + SW + W + NW;
		var nearbyinfected = 1
							 + 	 isinfected(N) + isinfected(NE) 
							 + 	 isinfected(E) + isinfected(SE) 
							 +   isinfected(S) + isinfected(SW) 
							 +   isinfected(W) + isinfected(NW);
		var averageinfection = nearbyinfection / nearbyinfected;
		C = sickness_rate + averageinfection;
		C = min(1, C);
	} else {
		// healthy cell:
		
		
		// number of var infected:
		var nearbyinfected = ( 
								 isinfected(N) + isinfected(NE) 
							 + 	 isinfected(E) + isinfected(SE) 
							 +   isinfected(S) + isinfected(SW) 
							 +   isinfected(W) + isinfected(NW) 
							 );
		// calculate number of var ill:
		var nearbyill  = ( 
							 isill(N) + isill(NE) 
						 + 	 isill(E) + isill(SE) 
						 +   isill(S) + isill(SW) 
						 +   isill(W) + isill(NW) 
						 );
		
		var influence = floor(nearbyinfected * infection_rate_infected) 
					  + floor(nearbyill * infection_rate_ill);
		
		C = initial_infection * influence;
	}
	// a sick cell gets sicker by a fixed amount, plus extra sickness due to infected neighbours. It cannot get sicker than the limit.
	// An uninfected cell may catch infection, depending on its neighbours.
	// At the next 'tick' any ill cells are healed!
	
	// return the new state:
	return C;
}

function update() {
	var tmp = past;
	past = field;
	field = tmp;
	
	field.set(transition);
} 

/// end of user code ///////////////////////////////////////////////////////////

al.start();
</script>
<a href="js.ants.html">See also ants1</a>
</body>
</html>