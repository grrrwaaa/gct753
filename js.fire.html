<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<script src="http://grrrwaaa.github.io/gct753/al.min.js"></script>
<style>
body {
	background: #eee;
	width: 512px;
	min-height: 100%;
	margin: 50px auto 50px auto;
}
</style>
</head>
<body>
<script>

al.init();

/// put your code here /////////////////////////////////////////////////////////

var dimx = 256;
var dimy = dimx/2;

var field = new field2D(dimx, dimy);
var past = new field2D(dimx, dimy);

// three possible states:
var empty = 0;
var tree = 0.5;
var burning = 1;

// the chance of an empty cell regrowing trees by expansion:
var growth_probability = 1/100;
// the chance of an empty cell regrowing trees by random sporing:
var spore_probability = 1/100000;
// the chance of lighting striking a cell:
var lightning_probability = 1/100000;

function initialize() {
	if (random() < spore_probability) {
		return tree;
	}
}

function reset() {
	field.set(initialize);
}
reset();

// how to r}er the scene
function draw(ctx)	{
	// draw the field (by default it fills the canvas):
	field.draw();
}

// the rule for an individual cell (at position x, y) in the field:
function transition(x, y) {

	// check out the neighbors' previous states:
	var N  = past.get(x  , y+1);
	var NE = past.get(x+1, y+1);
	var E  = past.get(x+1, y  );
	var SE = past.get(x+1, y-1);
	var S  = past.get(x  , y-1);
	var SW = past.get(x-1, y-1);
	var W  = past.get(x-1, y  );
	var NW = past.get(x-1, y+1);
	
	// true if (any neighb|| is a tree:
	var neartree = N == tree || E == tree 
				|| W == tree || S == tree 
				|| NE == tree || SE == tree 
				|| NW == tree || SW == tree;
	
	// true if (any neighb|| is burning:
	var nearburning = N == burning || E == burning 
				|| W == burning || S == burning 
				|| NE == burning || SE == burning 
				|| NW == burning || SW == burning;
	
	// check my own previous state:
	var C = past.get(x, y);
	
	if (C == empty) {
		// are any neighbors trees?
		if (neartree) {			
			// chance of regrowing:
			if (random() < growth_probability) {
				C = tree;
			}
		} else if  (random() < spore_probability) {
			// smaller chance of propagation by seeding:
			C = tree;
		}
	} else if  (C == tree) {
		// are any neighbors burning?
		if (nearburning) {
			// if (any neighbors are burning, start burning too:
			C = burning;
		
		} else if  (random() < lightning_probability) {		
			// otherwise, there's a small chance of catching fire due to atmostpheric conditions:
			C = burning;
		}
	} else if  (C == burning) {
		// a burning tree cell becomes an empty cell
		C = empty;
	} 
	
	// return the new state:
	return C;
}

function update() {
	var tmp = past;
	past = field;
	field = tmp;
	
	field.set(transition);
} 

/// end of user code ///////////////////////////////////////////////////////////

al.start();
</script>
<a href="js.ants.html">See also ants1</a>
</body>
</html>